Informe práctica 3
El script consta de dos funciones principales, agnadirUser para agregar usuarios y eliminarUser para eliminar usuarios. Estas funciones encapsulan las acciones necesarias para realizar las tareas especificadas en la práctica.
Antes de ejecutar cualquier acción, se verifica si el usuario actual tiene derechos de administrador comparando el ID de usuario (UID) con id -u. Si el ID de usuario es diferente de 0, se muestra un mensaje de advertencia y se finaliza el script. Además, se contempla la opción de realizar esta comprobación mediante el comando EUID y verificar si es diferente de 0.
El script requiere dos parámetros de entrada: opciones (-a para agregar un nuevo usuario, -s para eliminar un usuario) y el nombre de un archivo que contiene datos del usuario en un formato específico (nombre de usuario, contraseña, nombre completo). Si la opción utilizada no es ninguna de esas dos, se muestra el mensaje "Opción inválida" en la salida de error.
El script procesa archivos separados por comas para leer los datos del usuario. Utiliza cat y read para leer cada línea del archivo y luego divide la línea en trozos usando comas como separadores. Se establece el separador IFS como "," para este propósito.
Se realizan varias comprobaciones de errores para garantizar que todo se realice correctamente, como verificar si el archivo tiene los campos obligatorios y si el usuario existía antes de agregarlo o eliminarlo. Si no se cumplen las condiciones de cantidad de campos requeridos, se envía el mensaje "Campo inválido" a la salida de error.
Para verificar la existencia de un usuario, se utiliza el comando id $1. Se contempló inicialmente hacerlo comparando con el archivo /etc/passwd pero se optó por esta solución.
Antes de eliminar a un usuario, se crea una copia de seguridad del directorio de inicio del usuario en un archivo .tar en el directorio /extra/backup, el cual se crea si no existe.
Cuando se agrega un nuevo usuario, se configuran parámetros específicos del usuario, como la cantidad máxima de días antes de cambiar la contraseña y el ID mínimo de usuario, utilizando la opción -K de useradd.
Se establece la contraseña del usuario utilizando echo "$1:$2" | chpasswd y se desbloquea la cuenta del usuario si está bloqueada mediante usermod -U "$1".
El uso de &>/dev/null en varias ocasiones del código evita que los mensajes se muestren en la salida estándar o de error, redirigiéndolos a /dev/null, útil para mantener el script limpio y sin mensajes innecesarios.
En resumen, el script proporciona una manera eficiente de administrar usuarios mediante funciones modulares, procesamiento de archivos, manejo de errores y configuraciones específicas del usuario.